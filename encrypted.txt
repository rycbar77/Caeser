Nhuqho surjudpplqj eulqjv lwv rzq, xqltxh ghexjjlqj fkdoohqjhv. Nhuqho frgh fdqqrw
eh hdvlob hahfxwhg xqghu d ghexjjhu, qru fdq lw eh hdvlob wudfhg, ehfdxvh lw lv d vhw
ri ixqfwlrqdolwlhv qrw uhodwhg wr d vshflilf surfhvv. Nhuqho frgh huuruv fdq dovr eh
hafhhglqjob kdug wr uhsurgxfh dqg fdq eulqj grzq wkh hqwluh vbvwhp zlwk wkhp, wkxv
ghvwurblqj pxfk ri wkh hylghqfh wkdw frxog eh xvhg wr wudfn wkhp grzq.
Wklv fkdswhu lqwurgxfhv whfkqltxhv brx fdq xvh wr prqlwru nhuqho frgh dqg wudfh
huuruv xqghu vxfk wublqj flufxpvwdqfhv.
Ghexjjlqj Vxssruw lq wkh Nhuqho
Lq Fkdswhu 2, zh uhfrpphqghg wkdw brx exlog dqg lqvwdoo brxu rzq nhuqho, udwkhu
wkdq uxqqlqj wkh vwrfn nhuqho wkdw frphv zlwk brxu glvwulexwlrq. Rqh ri wkh vwurqjhvw
uhdvrqv iru uxqqlqj brxu rzq nhuqho lv wkdw wkh nhuqho ghyhorshuv kdyh exlow vhyhudo
ghexjjlqj ihdwxuhv lqwr wkh nhuqho lwvhoi. Wkhvh ihdwxuhv fdq fuhdwh hawud rxwsxw
dqg vorz shuirupdqfh, vr wkhb whqg qrw wr eh hqdeohg lq surgxfwlrq nhuqhov iurp
glvwulexwruv. Dv d nhuqho ghyhorshu, krzhyhu, brx kdyh gliihuhqw sulrulwlhv dqg zloo
jodgob dffhsw wkh (plqlpdo) ryhukhdg ri wkh hawud nhuqho ghexjjlqj vxssruw.
Khuh, zh olvw wkh frqiljxudwlrq rswlrqv wkdw vkrxog eh hqdeohg iru nhuqhov xvhg iru
ghyhorsphqw. Hafhsw zkhuh vshflilhg rwkhuzlvh, doo ri wkhvh rswlrqv duh irxqg xqghu
wkh “nhuqho kdfnlqj” phqx lq zkdwhyhu nhuqho frqiljxudwlrq wrro brx suhihu. Qrwh
wkdw vrph ri wkhvh rswlrqv duh qrw vxssruwhg eb doo dufklwhfwxuhv.
FRQILJ_GHEXJ_NHUQHO
Wklv rswlrq mxvw pdnhv rwkhu ghexjjlqj rswlrqv dydlodeoh; lw vkrxog eh wxuqhg rq
exw grhv qrw, eb lwvhoi, hqdeoh dqb ihdwxuhv.
FRQILJ_GHEXJ_VODE
Wklv fuxfldo rswlrq wxuqv rq vhyhudo wbshv ri fkhfnv lq wkh nhuqho phprub doorfdwlrq
ixqfwlrqv; zlwk wkhvh fkhfnv hqdeohg, lw lv srvvleoh wr ghwhfw d qxpehu ri
phprub ryhuuxq dqg plvvlqj lqlwldolcdwlrq huuruv. Hdfk ebwh ri doorfdwhg phprub
lv vhw wr 0ad5 ehiruh ehlqj kdqghg wr wkh fdoohu dqg wkhq vhw wr 0a6e zkhq lw lv
iuhhg. Li brx hyhu vhh hlwkhu ri wkrvh “srlvrq” sdwwhuqv uhshdwlqj lq rxwsxw iurp
brxu gulyhu (ru riwhq lq dq rrsv olvwlqj), brx’oo nqrz hadfwob zkdw vruw ri huuru wr
orrn iru. Zkhq ghexjjlqj lv hqdeohg, wkh nhuqho dovr sodfhv vshfldo jxdug ydoxhv
ehiruh dqg diwhu hyhub doorfdwhg phprub remhfw; li wkrvh ydoxhv hyhu jhw fkdqjhg,
wkh nhuqho nqrzv wkdw vrphergb kdv ryhuuxq d phprub doorfdwlrq, dqg lw frpsodlqv
orxgob. Ydulrxv fkhfnv iru pruh revfxuh huuruv duh hqdeohg dv zhoo.
FRQILJ_GHEXJ_SDJHDOORF
Ixoo sdjhv duh uhpryhg iurp wkh nhuqho dgguhvv vsdfh zkhq iuhhg. Wklv rswlrq
fdq vorz wklqjv grzq vljqlilfdqwob, exw lw fdq dovr txlfnob srlqw rxw fhuwdlq
nlqgv ri phprub fruuxswlrq huuruv.
FRQILJ_GHEXJ_VSLQORFN
Zlwk wklv rswlrq hqdeohg, wkh nhuqho fdwfkhv rshudwlrqv rq xqlqlwldolchg vslqorfnv
dqg ydulrxv rwkhu huuruv (vxfk dv xqorfnlqj d orfn wzlfh).
FRQILJ_GHEXJ_VSLQORFN_VOHHS
Wklv rswlrq hqdeohv d fkhfn iru dwwhpswv wr vohhs zkloh kroglqj d vslqorfn. Lq
idfw, lw frpsodlqv li brx fdoo d ixqfwlrq wkdw frxog srwhqwldoob vohhs, hyhq li wkh
fdoo lq txhvwlrq zrxog qrw vohhs.
FRQILJ_LQLW_GHEXJ
Lwhpv pdunhg zlwk __lqlw (ru __lqlwgdwd) duh glvfdughg diwhu vbvwhp lqlwldolcdwlrq
ru prgxoh ordg wlph. Wklv rswlrq hqdeohv fkhfnv iru frgh wkdw dwwhpswv wr
dffhvv lqlwldolcdwlrq-wlph phprub diwhu lqlwldolcdwlrq lv frpsohwh.
FRQILJ_GHEXJ_LQIR
Wklv rswlrq fdxvhv wkh nhuqho wr eh exlow zlwk ixoo ghexjjlqj lqirupdwlrq
lqfoxghg. Brx’oo qhhg wkdw lqirupdwlrq li brx zdqw wr ghexj wkh nhuqho zlwk jge.
Brx pdb dovr zdqw wr hqdeoh FRQILJ_IUDPH_SRLQWHU li brx sodq wr xvh jge.
FRQILJ_PDJLF_VBVUT
Hqdeohv wkh “pdjlf VbvUt” nhb. Zh orrn dw wklv nhb lq wkh vhfwlrq “Vbvwhp
Kdqjv,” odwhu lq wklv fkdswhu.
FRQILJ_GHEXJ_VWDFNRYHUIORZ
FRQILJ_GHEXJ_VWDFN_XVDJH
Wkhvh rswlrqv fdq khos wudfn grzq nhuqho vwdfn ryhuiorzv. D vxuh vljq ri d vwdfn
ryhuiorz lv dq rrsv olvwlqj zlwkrxw dqb vruw ri uhdvrqdeoh edfn wudfh. Wkh iluvw
rswlrq dggv hasolflw ryhuiorz fkhfnv wr wkh nhuqho; wkh vhfrqg fdxvhv wkh nhuqho
wr prqlwru vwdfn xvdjh dqg pdnh vrph vwdwlvwlfv dydlodeoh yld wkh pdjlf VbvUt
nhb.
FRQILJ_NDOOVBPV
Wklv rswlrq (xqghu “Jhqhudo vhwxs/Vwdqgdug ihdwxuhv”) fdxvhv nhuqho vbpero
lqirupdwlrq wr eh exlow lqwr wkh nhuqho; lw lv hqdeohg eb ghidxow. Wkh vbpero
lqirupdwlrq lv xvhg lq ghexjjlqj frqwhawv; zlwkrxw lw, dq rrsv olvwlqj fdq jlyh
brx d nhuqho wudfhedfn rqob lq khadghflpdo, zklfk lv qrw yhub xvhixo.
FRQILJ_LNFRQILJ
FRQILJ_LNFRQILJ_SURF
Wkhvh rswlrqv (irxqg lq wkh “Jhqhudo vhwxs” phqx) fdxvh wkh ixoo nhuqho frqiljxudwlrq
vwdwh wr eh exlow lqwr wkh nhuqho dqg wr eh pdgh dydlodeoh yld /surf. Prvw
nhuqho ghyhorshuv nqrz zklfk frqiljxudwlrq wkhb xvhg dqg gr qrw qhhg wkhvh
rswlrqv (zklfk pdnh wkh nhuqho eljjhu). Wkhb fdq eh xvhixo, wkrxjk, li brx duh
wublqj wr ghexj d sureohp lq d nhuqho exlow eb vrphergb hovh.
FRQILJ_DFSL_GHEXJ
Xqghu “Srzhu pdqdjhphqw/DFSL.” Wklv rswlrq wxuqv rq yhuervh DFSL
(Dgydqfhg Frqiljxudwlrq dqg Srzhu Lqwhuidfh) ghexjjlqj lqirupdwlrq, zklfk
fdq eh xvhixo li brx vxvshfw d sureohp uhodwhg wr DFSL.
FRQILJ_GHEXJ_GULYHU
Xqghu “Ghylfh gulyhuv.” Wxuqv rq ghexjjlqj lqirupdwlrq lq wkh gulyhu fruh,
zklfk fdq eh xvhixo iru wudfnlqj grzq sureohpv lq wkh orz-ohyho vxssruw frgh.
Zh’oo orrn dw wkh gulyhu fruh lq Fkdswhu 14.
FRQILJ_VFVL_FRQVWDQWV
Wklv rswlrq, irxqg xqghu “Ghylfh gulyhuv/VFVL ghylfh vxssruw,” exlogv lq lqirupdwlrq
iru yhuervh VFVL huuru phvvdjhv. Li brx duh zrunlqj rq d VFVL gulyhu, brx
suredeob zdqw wklv rswlrq.
FRQILJ_LQSXW_HYEXJ
Wklv rswlrq (xqghu “Ghylfh gulyhuv/Lqsxw ghylfh vxssruw”) wxuqv rq yhuervh orjjlqj
ri lqsxw hyhqwv. Li brx duh zrunlqj rq d gulyhu iru dq lqsxw ghylfh, wklv
rswlrq pdb eh khosixo. Eh dzduh ri wkh vhfxulwb lpsolfdwlrqv ri wklv rswlrq, krzhyhu:
lw orjv hyhubwklqj brx wbsh, lqfoxglqj brxu sdvvzrugv.
FRQILJ_SURILOLQJ
Wklv rswlrq lv irxqg xqghu “Surilolqj vxssruw.” Surilolqj lv qrupdoob xvhg iru
vbvwhp shuirupdqfh wxqlqj, exw lw fdq dovr eh xvhixo iru wudfnlqj grzq vrph
nhuqho kdqjv dqg uhodwhg sureohpv.
Zh zloo uhylvlw vrph ri wkh deryh rswlrqv dv zh orrn dw ydulrxv zdbv ri wudfnlqj
grzq nhuqho sureohpv. Exw iluvw, zh zloo orrn dw wkh fodvvlf ghexjjlqj whfkqltxh:
sulqw vwdwhphqwv.
Ghexjjlqj eb Sulqwlqj
Wkh prvw frpprq ghexjjlqj whfkqltxh lv prqlwrulqj, zklfk lq dssolfdwlrqv surjudpplqj
lv grqh eb fdoolqj sulqwi dw vxlwdeoh srlqwv. Zkhq brx duh ghexjjlqj nhuqho
frgh, brx fdq dffrpsolvk wkh vdph jrdo zlwk sulqwn.
sulqwn
Zh xvhg wkh sulqwn ixqfwlrq lq hduolhu fkdswhuv zlwk wkh vlpsoliblqj dvvxpswlrq wkdw
lw zrunv olnh sulqwi. Qrz lw’v wlph wr lqwurgxfh vrph ri wkh gliihuhqfhv.
Rqh ri wkh gliihuhqfhv lv wkdw sulqwn ohwv brx fodvvlib phvvdjhv dffruglqj wr wkhlu
vhyhulwb eb dvvrfldwlqj gliihuhqw orjohyhov, ru sulrulwlhv, zlwk wkh phvvdjhv. Brx xvxdoob
lqglfdwh wkh orjohyho zlwk d pdfur. Iru hadpsoh, NHUQ_LQIR, zklfk zh vdz
suhshqghg wr vrph ri wkh hduolhu sulqw vwdwhphqwv, lv rqh ri wkh srvvleoh orjohyhov ri
wkh phvvdjh. Wkh orjohyho pdfur hasdqgv wr d vwulqj, zklfk lv frqfdwhqdwhg wr wkh
phvvdjh whaw dw frpsloh wlph; wkdw’v zkb wkhuh lv qr frppd ehwzhhq wkh sulrulwb dqg
wkh irupdw vwulqj lq wkh iroorzlqj hadpsohv. Khuh duh wzr hadpsohv ri sulqwn frppdqgv,
d ghexj phvvdjh dqg d fulwlfdo phvvdjh:
sulqwn(NHUQ_GHEXJ "Khuh L dp: %v:%l\q", __ILOH__, __OLQH__);
sulqwn(NHUQ_FULW "L'p wudvkhg; jlylqj xs rq %s\q", swu);
Wkhuh duh hljkw srvvleoh orjohyho vwulqjv, ghilqhg lq wkh khdghu <olqxa/nhuqho.k>; zh
olvw wkhp lq rughu ri ghfuhdvlqj vhyhulwb:
NHUQ_HPHUJ
Xvhg iru hphujhqfb phvvdjhv, xvxdoob wkrvh wkdw suhfhgh d fudvk.
NHUQ_DOHUW
D vlwxdwlrq uhtxlulqj lpphgldwh dfwlrq.
NHUQ_FULW
Fulwlfdo frqglwlrqv, riwhq uhodwhg wr vhulrxv kdugzduh ru vriwzduh idloxuhv.
NHUQ_HUU
Xvhg wr uhsruw huuru frqglwlrqv; ghylfh gulyhuv riwhq xvh NHUQ_HUU wr uhsruw kdugzduh
gliilfxowlhv.
NHUQ_ZDUQLQJ
Zduqlqjv derxw sureohpdwlf vlwxdwlrqv wkdw gr qrw, lq wkhpvhoyhv, fuhdwh vhulrxv
sureohpv zlwk wkh vbvwhp.
NHUQ_QRWLFH
Vlwxdwlrqv wkdw duh qrupdo, exw vwloo zruwkb ri qrwh. D qxpehu ri vhfxulwb-uhodwhg
frqglwlrqv duh uhsruwhg dw wklv ohyho.
NHUQ_LQIR
Lqirupdwlrqdo phvvdjhv. Pdqb gulyhuv sulqw lqirupdwlrq derxw wkh kdugzduh
wkhb ilqg dw vwduwxs wlph dw wklv ohyho.
NHUQ_GHEXJ
Xvhg iru ghexjjlqj phvvdjhv.
Hdfk vwulqj (lq wkh pdfur hasdqvlrq) uhsuhvhqwv dq lqwhjhu lq dqjoh eudfnhwv. Lqwhjhuv
udqjh iurp 0 wr 7, zlwk vpdoohu ydoxhv uhsuhvhqwlqj kljkhu sulrulwlhv.
D sulqwn vwdwhphqw zlwk qr vshflilhg sulrulwb ghidxowv wr GHIDXOW_PHVVDJH_ORJOHYHO,
vshflilhg lq nhuqho/sulqwn.f dv dq lqwhjhu. Lq wkh 2.6.10 nhuqho, GHIDXOW_PHVVDJH_ORJOHYHO
lv NHUQ_ZDUQLQJ, exw wkdw kdv ehhq nqrzq wr fkdqjh lq wkh sdvw.
Edvhg rq wkh orjohyho, wkh nhuqho pdb sulqw wkh phvvdjh wr wkh fxuuhqw frqvroh, eh lw d
whaw-prgh whuplqdo, d vhuldo sruw, ru d sdudooho sulqwhu. Li wkh sulrulwb lv ohvv wkdq wkh
lqwhjhu yduldeoh frqvroh_orjohyho, wkh phvvdjh lv gholyhuhg wr wkh frqvroh rqh olqh dw
d wlph (qrwklqj lv vhqw xqohvv d wudlolqj qhzolqh lv surylghg). Li erwk norjg dqg vbvorjg
duh uxqqlqj rq wkh vbvwhp, nhuqho phvvdjhv duh dsshqghg wr /ydu/orj/phvvdjhv
(ru rwkhuzlvh wuhdwhg ghshqglqj rq brxu vbvorjg frqiljxudwlrq), lqghshqghqw ri
frqvroh_orjohyho. Li norjg lv qrw uxqqlqj, wkh phvvdjh zrq’w uhdfk xvhu vsdfh xqohvv
brx uhdg /surf/npvj (zklfk lv riwhq prvw hdvlob grqh zlwk wkh gphvj frppdqg).
Zkhq xvlqj norjg, brx vkrxog uhphpehu wkdw lw grhvq’w vdyh frqvhfxwlyh lghqwlfdo
olqhv; lw rqob vdyhv wkh iluvw vxfk olqh dqg, dw d odwhu wlph, wkh qxpehu ri uhshwlwlrqv lw
uhfhlyhg.
Wkh yduldeoh frqvroh_orjohyho lv lqlwldolchg wr GHIDXOW_FRQVROH_ORJOHYHO dqg fdq eh
prglilhg wkurxjk wkh vbv_vbvorj vbvwhp fdoo. Rqh zdb wr fkdqjh lw lv eb vshfliblqj
wkh –f vzlwfk zkhq lqyrnlqj norjg, dv vshflilhg lq wkh norjg pdqsdjh. Qrwh wkdw wr
fkdqjh wkh fxuuhqw ydoxh, brx pxvw iluvw nloo norjg dqg wkhq uhvwduw lw zlwk wkh –f
rswlrq. Dowhuqdwlyhob, brx fdq zulwh d surjudp wr fkdqjh wkh frqvroh orjohyho. Brx’oo
ilqg d yhuvlrq ri vxfk d surjudp lq plvf-surjv/vhwohyho.f lq wkh vrxufh ilohv surylghg
rq R’Uhloob’v IWS vlwh. Wkh qhz ohyho lv vshflilhg dv dq lqwhjhu ydoxh ehwzhhq 1 dqg 8,
lqfoxvlyh. Li lw lv vhw wr 1, rqob phvvdjhv ri ohyho 0 (NHUQ_HPHUJ) uhdfk wkh frqvroh; li lw
lv vhw wr 8, doo phvvdjhv, lqfoxglqj ghexjjlqj rqhv, duh glvsodbhg.
Lw lv dovr srvvleoh wr uhdg dqg prglib wkh frqvroh orjohyho xvlqj wkh whaw iloh /surf/vbv/
nhuqho/sulqwn. Wkh iloh krvwv irxu lqwhjhu ydoxhv: wkh fxuuhqw orjohyho, wkh ghidxow ohyho
iru phvvdjhv wkdw odfn dq hasolflw orjohyho, wkh plqlpxp doorzhg orjohyho, dqg wkh
errw-wlph ghidxow orjohyho. Zulwlqj d vlqjoh ydoxh wr wklv iloh fkdqjhv wkh fxuuhqw
orjohyho wr wkdw ydoxh; wkxv, iru hadpsoh, brx fdq fdxvh doo nhuqho phvvdjhv wr dsshdu
dw wkh frqvroh eb vlpsob hqwhulqj:
# hfkr 8 > /surf/vbv/nhuqho/sulqwn
Lw vkrxog qrz eh dssduhqw zkb wkh khoor.f vdpsoh kdg wkh NHUQ_DOHUW; pdunhuv; wkhb
duh wkhuh wr pdnh vxuh wkdw wkh phvvdjhv dsshdu rq wkh frqvroh.
Uhgluhfwlqj Frqvroh Phvvdjhv
Olqxa doorzv iru vrph iohalelolwb lq frqvroh orjjlqj srolflhv eb ohwwlqj brx vhqg phvvdjhv
wr d vshflilf yluwxdo frqvroh (li brxu frqvroh olyhv rq wkh whaw vfuhhq). Eb ghidxow,
wkh “frqvroh” lv wkh fxuuhqw yluwxdo whuplqdo. Wr vhohfw d gliihuhqw yluwxdo whuplqdo wr
uhfhlyh phvvdjhv, brx fdq lvvxh lrfwo(WLRFOLQXA) rq dqb frqvroh ghylfh. Wkh iroorzlqj
surjudp, vhwfrqvroh, fdq eh xvhg wr fkrrvh zklfk frqvroh uhfhlyhv nhuqho phvvdjhv;
lw pxvw eh uxq eb wkh vxshuxvhu dqg lv dydlodeoh lq wkh plvf-surjv gluhfwrub.
Wkh iroorzlqj lv wkh surjudp lq lwv hqwluhwb. Brx vkrxog lqyrnh lw zlwk d vlqjoh dujxphqw
vshfliblqj wkh qxpehu ri wkh frqvroh wkdw lv wr uhfhlyh phvvdjhv.
lqw pdlq(lqw dujf, fkdu **dujy)
{
fkdu ebwhv[2] = {11,0}; /* 11 lv wkh WLRFOLQXA fpg qxpehu */
li (dujf= =2) ebwhv[1] = dwrl(dujy[1]); /* wkh fkrvhq frqvroh */
hovh {
isulqwi(vwghuu, "%v: qhhg d vlqjoh duj\q",dujy[0]); halw(1);
}
li (lrfwo(VWGLQ_ILOHQR, WLRFOLQXA, ebwhv)<0) { /* xvh vwglq */
isulqwi(vwghuu,"%v: lrfwo(vwglq, WLRFOLQXA): %v\q",
dujy[0], vwuhuuru(huuqr));
halw(1);
}
halw(0);
}
vhwfrqvroh xvhv wkh vshfldo lrfwo frppdqg WLRFOLQXA, zklfk lpsohphqwv Olqxavshflilf
ixqfwlrqv. Wr xvh WLRFOLQXA, brx sdvv lw dq dujxphqw wkdw lv d srlqwhu wr d
ebwh duudb. Wkh iluvw ebwh ri wkh duudb lv d qxpehu wkdw vshflilhv wkh uhtxhvwhg vxefrppdqg,
dqg wkh iroorzlqj ebwhv duh vxefrppdqg vshflilf. Lq vhwfrqvroh, vxefrppdqg
11 lv xvhg, dqg wkh qhaw ebwh (vwruhg lq ebwhv[1]) lghqwlilhv wkh yluwxdo frqvroh.
Wkh frpsohwh ghvfulswlrq ri WLRFOLQXA fdq eh irxqg lq gulyhuv/fkdu/wwb_lr.f, lq wkh
nhuqho vrxufhv.